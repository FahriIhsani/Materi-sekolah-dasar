<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bukti Karya: Pemanfaatan Gemini di SD NEGERI 14 SAWIT PERMAI</title>
    <!-- Memuat Tailwind CSS untuk styling modern dan responsif -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Menggunakan font Inter -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fb;
        }
        /* Custom styles for the school theme */
        .header-bg {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }
        .gemini-card {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <!-- Header Aplikasi -->
    <header class="header-bg p-6 text-white shadow-lg">
        <div class="container mx-auto">
            <h1 class="text-3xl font-extrabold tracking-tight md:text-4xl">
                SD NEGERI 14 SAWIT PERMAI
            </h1>
            <p class="mt-1 text-lg font-light">
                Bukti Karya Pemanfaatan Gemini untuk IPAS Kelas 6
            </p>
        </div>
    </header>

    <!-- Konten Utama -->
    <main class="flex-grow container mx-auto p-4 md:p-8">
        <div class="max-w-4xl mx-auto">
            
            <!-- Deskripsi Materi -->
            <section class="mb-8 p-6 bg-white rounded-xl border-t-4 border-emerald-500 shadow-md">
                <h2 class="text-2xl font-bold text-gray-800 mb-3">
                    Asisten IPAS: Transformasi Energi
                </h2>
                <p class="text-gray-600">
                    Siswa/i Kelas 6 dapat bertanya apa saja tentang **perubahan bentuk energi** (contoh: energi listrik menjadi cahaya, energi kimia menjadi gerak) kepada Asisten Gemini.
                </p>
            </section>

            <!-- Antarmuka Chat -->
            <section class="gemini-card bg-white rounded-xl p-6 md:p-8">
                <h3 class="text-xl font-semibold text-gray-700 mb-4">Ajukan Pertanyaanmu!</h3>
                
                <!-- Area Input Pertanyaan -->
                <div class="flex flex-col md:flex-row gap-4 mb-6">
                    <input type="text" id="userInput" placeholder="Contoh: 'Apa itu energi kinetik?' atau 'Beri aku contoh perubahan energi.'" 
                           class="flex-grow p-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-emerald-500 transition duration-150 text-gray-700">
                    <button id="askButton" onclick="askGemini()" 
                            class="px-6 py-3 bg-emerald-600 text-white font-bold rounded-lg hover:bg-emerald-700 transition duration-300 shadow-md">
                        Tanyakan
                    </button>
                </div>
                
                <!-- Area Tampilan Respon -->
                <div id="responseArea" class="mt-6 border-t pt-6">
                    <div id="loadingIndicator" class="hidden flex items-center justify-center space-x-2 text-emerald-600">
                        <!-- Icon loading sederhana -->
                        <svg class="animate-spin h-5 w-5 mr-3" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" fill="none"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        <span>Gemini sedang berpikir...</span>
                    </div>

                    <div id="geminiResponse" class="p-4 bg-gray-50 rounded-lg text-gray-700 min-h-[100px] border border-gray-200">
                        <p class="text-lg font-medium text-emerald-600">Halo, Anak Hebat!</p>
                        <p class="mt-2">Saya Asisten Gemini. Ayo kita belajar tentang energi! Tuliskan pertanyaanmu di atas dan saya akan bantu menjelaskannya.</p>
                    </div>
                    
                    <div id="errorBox" class="hidden mt-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded-lg">
                        Terjadi kesalahan saat menghubungi Asisten. Coba lagi!
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white p-4 mt-8">
        <div class="container mx-auto text-center text-sm">
            &copy; 2025 Bukti Karya | SD NEGERI 14 SAWIT PERMAI
        </div>
    </footer>

    <!-- Skrip Interaksi dan Simulasi API Gemini -->
    <script>
        // Variabel global yang disediakan oleh lingkungan Canvas (hanya untuk simulasi struktur)
        const apiKey = ""; 
        const modelName = "gemini-2.5-flash-preview-09-2025";
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/${modelName}:generateContent?key=${apiKey}`;

        const loadingIndicator = document.getElementById('loadingIndicator');
        const geminiResponse = document.getElementById('geminiResponse');
        const errorBox = document.getElementById('errorBox');
        const userInput = document.getElementById('userInput');
        const askButton = document.getElementById('askButton');
        
        // Konstanta dan utilitas untuk simulasi API
        const MAX_RETRIES = 5;

        // Fungsi bantuan untuk Base64 ke ArrayBuffer (jika API responsnya audio/gambar, tidak digunakan di sini)
        function base64ToArrayBuffer(base64) {
            const binaryString = atob(base64);
            const len = binaryString.length;
            const bytes = new Uint8Array(len);
            for (let i = 0; i < len; i++) {
                bytes[i] = binaryString.charCodeAt(i);
            }
            return bytes.buffer;
        }

        /**
         * Fungsi untuk melakukan panggilan API Gemini (disimulasikan dengan struktur panggilan yang benar).
         * @param {string} prompt Pertanyaan dari siswa.
         */
        async function callGeminiAPI(prompt) {
            const systemPrompt = "Anda adalah asisten pengajar yang ramah untuk siswa kelas 6 SD. Jelaskan konsep tentang Energi dan Perubahannya dengan bahasa yang sangat sederhana, bersemangat, dan mudah dipahami. Jawaban maksimal 4 kalimat.";
            
            const payload = {
                contents: [{ parts: [{ text: prompt }] }],
                systemInstruction: {
                    parts: [{ text: systemPrompt }]
                },
                // Menonaktifkan grounding untuk fokus pada penjelasan materi sederhana
                // tools: [{ "google_search": {} }], 
            };

            const headers = {
                'Content-Type': 'application/json',
                // 'Authorization': `Bearer ${apiKey}` // Jika menggunakan auth token, tapi di sini kita pakai query param key
            };
            
            let lastError = null;

            for (let i = 0; i < MAX_RETRIES; i++) {
                try {
                    // Tampilkan loading, sembunyikan error
                    loadingIndicator.classList.remove('hidden');
                    geminiResponse.innerHTML = '';
                    errorBox.classList.add('hidden');
                    askButton.disabled = true;

                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: headers,
                        body: JSON.stringify(payload)
                    });
                    
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    const result = await response.json();
                    
                    // Proses Respon dan Ekstraksi Teks
                    const candidate = result.candidates?.[0];
                    if (candidate && candidate.content?.parts?.[0]?.text) {
                        const text = candidate.content.parts[0].text;
                        
                        // Ekstraksi sumber (jika grounding digunakan)
                        let sources = [];
                        const groundingMetadata = candidate.groundingMetadata;
                        if (groundingMetadata && groundingMetadata.groundingAttributions) {
                            sources = groundingMetadata.groundingAttributions
                                .map(attribution => ({
                                    uri: attribution.web?.uri,
                                    title: attribution.web?.title,
                                }))
                                .filter(source => source.uri && source.title);
                        }

                        // Sembunyikan loading
                        loadingIndicator.classList.add('hidden');
                        askButton.disabled = false;
                        
                        return { text: text, sources: sources };
                    } else {
                        throw new Error("Respon API tidak memiliki konten teks.");
                    }
                } catch (e) {
                    lastError = e;
                    console.error(`Attempt ${i + 1} failed:`, e);
                    if (i < MAX_RETRIES - 1) {
                        // Exponential backoff
                        const delay = Math.pow(2, i) * 1000 + Math.random() * 1000;
                        await new Promise(resolve => setTimeout(resolve, delay));
                    }
                }
            }

            // Jika semua percobaan gagal
            loadingIndicator.classList.add('hidden');
            errorBox.classList.remove('hidden');
            errorBox.textContent = "Maaf, Asisten Gemini sedang sibuk. Silakan coba lagi nanti.";
            askButton.disabled = false;
            throw lastError;
        }

        // Fungsi untuk menampilkan hasil atau simulasi
        async function askGemini() {
            const query = userInput.value.trim();
            if (query === "") {
                errorBox.classList.remove('hidden');
                errorBox.textContent = "Tulis dulu pertanyaanmu, ya!";
                return;
            }

            // --- Simulasi Respons karena keterbatasan API Key di lingkungan ini ---
            // Dalam implementasi nyata, kita akan memanggil `callGeminiAPI(query)`
            // Namun, untuk keperluan Bukti Karya yang berjalan tanpa API key, 
            // kita akan menampilkan simulasi respons LLM yang terstruktur.
            
            try {
                loadingIndicator.classList.remove('hidden');
                geminiResponse.innerHTML = '';
                errorBox.classList.add('hidden');
                askButton.disabled = true;
                
                // Menunggu sebentar untuk simulasi loading
                await new Promise(resolve => setTimeout(resolve, 2000)); 
                
                let responseText = generateSimulatedResponse(query);

                // Tampilkan respons
                geminiResponse.innerHTML = `
                    <p class="text-lg font-medium text-emerald-600">Respons dari Asisten Gemini:</p>
                    <p class="mt-2">${responseText}</p>
                `;

            } catch (error) {
                console.error("Simulasi gagal:", error);
                errorBox.classList.remove('hidden');
                errorBox.textContent = "Terjadi kesalahan saat memproses permintaan. Silakan coba lagi.";
            } finally {
                loadingIndicator.classList.add('hidden');
                askButton.disabled = false;
            }
        }

        /**
         * Mensimulasikan logika model yang telah diarahkan oleh System Prompt.
         * @param {string} query 
         */
        function generateSimulatedResponse(query) {
            query = query.toLowerCase();

            if (query.includes("energi kinetik")) {
                return "Wah, pertanyaan bagus! Energi Kinetik itu adalah energi yang dimiliki benda yang sedang bergerak. Ingat saja kata 'Kinetic' = Gerak! Contohnya, mobil yang melaju kencang atau air sungai yang mengalir deras. Semakin cepat geraknya, semakin besar energinya!";
            } else if (query.includes("perubahan energi")) {
                return "Sip! Perubahan energi itu artinya energi bisa berubah bentuk, lho. Misalnya, saat kamu menyalakan setrika, energi listrik berubah jadi energi panas. Atau, saat kamu makan nasi (energi kimia) lalu berlari (energi gerak)! Energi tidak bisa hilang, hanya berubah rupa!";
            } else if (query.includes("listrik")) {
                return "Listrik adalah energi paling hebat di rumah kita! Listrik bisa berubah jadi banyak hal. Contohnya, di lampu berubah jadi cahaya, di kipas angin berubah jadi gerak, dan di TV berubah jadi suara dan cahaya. Hebat, kan?";
            } else if (query.includes("kimia")) {
                return "Energi kimia biasanya tersimpan dalam makanan atau baterai. Saat kamu makan, energi kimia dari makanan membuatmu kuat dan bisa bergerak (energi gerak). Kalau di baterai, energi kimianya diubah jadi energi listrik! Pokoknya, energi tersimpan yang siap dipakai!";
            } else if (query.includes("matahari")) {
                return "Matahari adalah sumber energi terbesar! Energi panas dan cahaya dari Matahari membuat tanaman tumbuh (energi kimia), mengeringkan baju, dan bisa diubah menjadi listrik dengan alat canggih bernama panel surya. Jaga lingkungan, ya!";
            } else {
                return "Waaah, Asisten Gemini senang kamu bertanya! Energi adalah kemampuan untuk melakukan usaha. Ingat, energi itu bisa berubah bentuk. Coba kamu kasih contoh perubahan energi di rumahmu, pasti seru! Misalnya, energi apa jadi energi apa? Semangat belajar, Nak!";
            }
        }

        // Atur agar tombol 'Enter' juga memicu fungsi
        userInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                askGemini();
            }
        });

    </script>
</body>
</html>
